---
layout: blog
istop: false
title: "动态库传参勿用stl变量"
category: 知识归纳
background: purple
tags:
- 动态库
---

最近新引擎在安卓平台遇到了问题：在armlinux下编译和运行都没问题，但是在安卓上运行会崩溃。

这个问题不是我排查的，不过崩溃的原因值得记录。是因为在动态库接口里使用了stl变量。导致问题的原因有两点：

1. stl变量大多会直接或者间接地使用静态变量，而静态变量并不是**全局**唯一的——只是**编译单元内**唯一。因此，静态变量在主程序和动态库中都会有一份拷贝。

2. 主程序和动态库使用的编译器可能不一样，不同的编译器编译出来的变量内存布局可能不同。因此在主程序和动态库之间传递stl变量，可能导致访问出错。

总之，库的接口尽量不要使用stl变量。

## 参考资料
1. [DLL中传递STL参数，vector对象作为dll参数传递等问题](https://www.cnblogs.com/lidabo/p/3300327.html)

