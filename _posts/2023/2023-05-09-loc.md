---
layout: blog
istop: false
title: "汽车定位技术总结"
category: 知识归纳
background: grey
background-image: https://s2.loli.net/2024/06/08/trwyoUGg3id9VTe.png
tags:
- 自动驾驶
- 定位
---

# 汽车定位技术概述

按原理不同，汽车定位技术可分为以下三类：

1. GNSS（Global Navigation Satellite System）全球导航卫星系统，比如GPS、BDS。
2. 导航递推。利用IMU等车载传感器和之前时刻汽车位姿推算当前时刻位姿。
3. 地图匹配。使用LiDAR或者Camera采集到的数据特征和高精地图进行匹配，得到位姿。

# 时间与坐标系

## 常用时间

### 世界时(Universal Time, UT)

基于地球转动的时间计量方式，不是均匀流过，由于地球自转逐渐变慢，世界时的流速也在变慢

### 原子时(International Atomic Time, TAI)

基于原子钟（原子能级跃迁有极高稳定性），均匀流过, 1958年1月1日创立;

### 协调世界时(Universal Time Coordinate , UTC)

由于世界时的流动变慢，而原子时均匀流过，那么原子时的领先量就会逐渐增加，当原子时领先世界时达到0.9s时，就让原子时等待1s，具体做法则是闰秒机制，调整后的原子时为协调世界时。

### GPS时

时间基础是1980年1月6日0点的协调时，落后原子时19s。目前比UTC时间快18秒。

### 北斗时

北斗时始于2006年1月1日0点0分0秒。北斗周和GPS周相差1356周，**北斗秒和GPS秒相差14秒，**比UTC时间快4秒。

在使用GNSS卫星接收机时间时，用户需要注意使用的是哪个时间和对应的含义和基准。

## 常用坐标系

### 地心地固大地坐标系

原点在地球质心，跟随地球转动，以参考椭球面为基准面建立起来的坐标系，最常使用的为WGS84椭球体，GPS输出的位置信息即是WGS84的经纬高坐标系。

### 地理坐标系/当地水平坐标系

可以认为是地球椭球体在某点切平面上建立起来的空间直角坐标系，一般取**东北天**为XYZ，GNSS输出的东北天速度即是该坐标系下的表达。

### 车体坐标系

一般取车辆后轴中心为原点，建立空间直角坐标系，右前上或前左上为XYZ轴。

### 起始参考坐标系

某些场景下（如地库泊车），没有全局GNSS信号接入，此时也并不关心全局定位，只需确定某个固定不变的坐标系，定位出车辆在该坐标系下的坐标即可，此时可以将定位模块初始化时的位置定为原点（0，0，0），三个姿态角也都置0处理，之后进行位姿的递推估计。

# GNSS

## 定位原理

在地面上某点接收卫星信号，信号中包含信号发出时卫星的位置和时间，根据时间差和光速便可以算出与卫星的距离。如果同时知道三个卫星的位置及到它们的距离，那么分别以三个卫星为球心，与其距离为半径的三个球面将相交于两点。考虑到我们是在地球表面，再加上地球，四个球面将相交于一点，这就是我们自身的位置。因此，只需三颗卫星即可实现定位。

然而，接收机和卫星之间之间的时间难以严格同步。卫星钟差可以用导航电文中所给的有关钟差参数进行修正，但接收机的钟差大多难以精准确定。通常的做法是将接收机钟差也作为一个未知参数，与接收机的坐标一并求解。多了一个变量，需要更多信息去求解。所示实际上通常需要**四颗卫星**进行定位。

## GNSS 数据误差

![image-20240607222719529.png](https://s2.loli.net/2024/06/08/IEbhNfowMKj8kBF.png)

## 差分 GNSS

设置一个已知精确位置的基准站，基准站根据卫星信号计算出位置，与其实际位置进行比较，可以得到差分校正量。然后基准站将此差分校正量分发到期范围内的流动站进行数据修正。这种方式可以减少甚至消除卫星时钟、卫星星历、电离层延迟和对流层延迟所引起的误差，提高定位精度。

流动站与差分基准站越近，两战点间的测量误差就越相似，差分 GNSS 系统性能就越好。

差分 GNSS 又分为位置差分、伪距差分和**载波相位差分（RTK）**。

## GNSS 输出语句标准

美国国家海洋电子协会NMEA-0183协议是目前GNSS接收机上使用最广泛的协议，大多数常见的GNSS接收机、GNSS数据处理软件、导航软件都遵守或者至少兼容这个协议。协议中一共定义了7条标准语句。分别是GPGGA、GPGSA、GPGSV、GPRMC、GPVTG、GPGLL、GPZDA。这当中最常用的两条语句要属GPGGA和GPRMC。

![v2-fdd4d1e20c66f85acbe9cc31aa74d7d5.webp](https://s2.loli.net/2024/06/08/XzvsFfxb3j1anwi.webp)

# 惯性导航与轮速记

惯性导航系统（Inertial Navigation System， INS）既不依赖外部信息，也不向外辐射能量。其基于牛顿第三定律和角动量守恒原理进行位姿递推。常见的惯性测量单元（IMU）包括三个相互正交的单轴加速度计和三个相互正交的单轴陀螺仪。

轮速编码器也称轮速计，其测量原理是敏感转动信号，转动量通过脉冲数字的方式进行记录。根据轮胎半径和一个整圈脉冲字累计数量，可以换算出每个脉冲字变化对应的距离。对时间微分可以换算成车速。

# 地图匹配定位技术

参考 [视觉slam 笔记](https://www.kekeke.cn/2022/10/22/vision-slam.html) 

# 几种方式对比

![v2-7a24f5ce3a5d2898dfed3875124192ff_1440w.webp](https://s2.loli.net/2024/06/08/3qv4hY2wcT6WpCa.webp)

# 多传感器融合

GNSS 更新频率低，不能满足自动驾驶中实时性要求，且定位信号会因隧道、建筑群等障碍物的遮挡而中断。INS频率高，一定时间内可以提供连续的较高精度的位置、速度和航向信息，但误差会随着时间累积而剧增。将二者结合，可以利用GNSS提供的定位来纠正INS的累计定位误差，同时INS可以解决GNSS容易受场景影响的问题，可以得到实时和精准的定位。如果再与地图匹配技术相结合，可以进一步提高定位精度。实际应用中大多使用多传感器融合后的结果。

# 参考资料

- [开足马力的小蜗牛 - 知乎 (zhihu.com)](https://www.zhihu.com/people/kong-bai-ge-87-23-38/posts)

- 《自动驾驶-汽车定位技术》